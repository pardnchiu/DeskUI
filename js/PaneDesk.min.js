let at,rt,tt,et=0,ot=0,nt=0,lt=0;function it(t){(t=t||window.event).preventDefault(),et=nt-t.clientX,ot=lt-t.clientY,nt=t.clientX,lt=t.clientY;const e=tt.clientWidth,o=tt.clientHeight,n=tt.offsetLeft-et,l=tt.offsetTop-ot;e>vw?(tt.style.left="0px",tt.style.width=vw+"px"):n+e>vw?tt.style.left=vw-e+"px":n>=0&&n+e<=vw&&(tt.style.left=n+"px"),o>vh?(tt.style.top="0px",tt.style.height=vh+"px"):l+o>vh?tt.style.top=vh-o+"px":l>=0&&l+o<=vh&&(tt.style.top=l+"px"),ct(tt)}function st(){document.onmouseup=null,document.onmouseleave=null,document.onmouseout=null,document.onmousemove=null}function ft(){const t="div.window.focus".$;null!=t&&t.class_("focus")}function ct(t){ft(),t._class("focus")}export class PDWindow{constructor(t={}){ft();const e=t.title||"檔案夾",o=t.icon||"";let n=null!=t.top?parseInt(t.top):96,l=null!=t.left?parseInt(t.left):96,i=null!=t.width?parseInt(t.width):480,s=null!=t.height?parseInt(t.height):360,a=c();function c(){let t=Array.from("div.window".$all||[]).filter((t=>t.offsetTop==n&&t.offsetLeft==l)).length>0;return t&&(n+=24,l+=24),t}if(null==t.top||null==t.left)for(;a;)a=c();this.header="header"._(["strong"._(e),"section"._(["section"._(["button"._(["fa-solid fa-folder-plus"._fa]),"button"._(["fa-solid fa-list-ul"._fa]),"button"._(["fa-solid fa-border-all"._fa])]),"section"._(["button"._(["fa-solid fa-up-right-and-down-left-from-center"._fa])._click((t=>{const e=1===parseInt(this.body.dataset.max);this.body.dataset.max=e?0:1})),"button"._(["fa-solid fa-circle-minus"._fa])._click((t=>{this.body.dataset.max=0,"section.dock".$._child(this.body)})),"button"._(["fa-solid fa-circle-xmark"._fa])._click((t=>{this.body.remove()}))])])])._mousedown((t=>{t.preventDefault(),nt=t.clientX,lt=t.clientY,tt=this.body,document.onmouseup=st,document.onmouseleave=st,document.onmousemove=it})),this.section=t.content||"section"._(),this.body="div.window"._({title:e,"data-max":0,style:{top:n+"px",left:l+"px",width:i+"px",height:s+"px"}},["button"._(["img"._(o)])._click((t=>{document.body._child([t.target.$parent(0)])})),this.header,this.section])._click((t=>{ct(this.body)}))}}function ut(t,e){const o=t[e].files;return o.$keys._$((t=>{const e=o[t].type,n="folder"==e,l="link"==e,i=o[t].icon;return"div"._({draggable:"true"},["img"._(i),"span"._(t)])._dragstart((t=>{at=t.target}))._dragover((t=>{t.preventDefault()}))._dragenter((t=>{t.preventDefault(),t.target._class("over")}))._dragleave((t=>{t.preventDefault(),t.target.class_("over")}))._drop((t=>{t.preventDefault(),t.target!=at&&t.target.class_("over")}))._dragend((t=>{t.target.class_("over"),at&&t.target.parentNode!=rt&&rt._child(at),at=null}))._dblclick((e=>{if(n){const n=e.target.$parent(0),l=ut(o,t);n.__(),l.length&&n._child(l)}else l&&_t(t,o[t].href)}))}))}function _t(t,e){const o=new PDWindow({title:t,icon:"/image/broswer.svg",top:0,left:(vw-1024)/2,width:1024,height:640,content:"section"._(["iframe"._({src:e})])});document.body._child([o.body])}export{ut as getFiles,_t as openLink};